# 修复连接状态显示问题

## 问题分析

当前问题：在`startPolling`函数中，连接状态被立即设置为`connected`，而没有等待第一个`poll`请求完成，导致接口还在请求中，页面却显示已连接。

## 修复方案

只优化连接状态管理，不改变其他功能逻辑：

### 1. 修改`startPolling`函数

- 移除立即将连接状态设置为`connected`的代码
- 保持连接状态为`connecting`，直到第一个`poll`请求成功

### 2. 修改`poll`函数

- 确保只有在第一个请求成功后，才将连接状态设置为`connected`
- 处理请求过程中的状态变化

### 3. 保持其他逻辑不变

- 不改变轮询间隔
- 不改变消息处理逻辑
- 不改变重连机制

## 代码修改点

1. **`startPolling`函数**：移除第72-73行的状态设置
2. **`poll`函数**：保留现有的状态设置逻辑，确保只有在请求成功后才更新状态
3. **`initPolling`函数**：确保初始状态正确设置为`connecting`

## 预期效果

- 页面加载时显示"连接中..."
- 只有当第一个API请求成功后，才显示"已连接"
- 如果API请求失败，显示"连接错误，正在尝试重连..."
- 连接恢复后，显示"已连接"

## 修复后的状态流转

1. 初始状态：`connecting`（连接中...）
2. 第一个请求成功：`connected`（已连接）
3. 请求失败：`disconnected`（连接错误，正在尝试重连...）
4. 重连成功：`connected`（已连接）

通过这个修复，页面将准确反映当前的连接状态，提升用户体验。